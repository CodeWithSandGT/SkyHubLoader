local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- URL verifikasi dan loader
local verificationURL = "https://skyhub-web.vercel.app/api/verify?key="
local loaderURL = "https://raw.githubusercontent.com/CodeWithSandGT/SkyHubLoader/main/Loader2"

-- Library UI
local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/jensonhirst/Orion/main/source')))()
local Window = OrionLib:MakeWindow({
    Name = "SkyHub",
    HidePremium = false,
    SaveConfig = true,
    ConfigFolder = "SkyHubConfig",
    IntroText = "SkyHub"
})

local MainTab = Window:MakeTab({
    Name = "Main",
    Icon = "rbxassetid://4483345998",
    PremiumOnly = false
})

local CreditTab = Window:MakeTab({
	Name = "Credit",
	Icon = "rbxassetid://4483345998",
	PremiumOnly = false
})

CreditTab:AddLabel("Join our Discord: https://dsc.gg/skyhubs")
CreditTab:AddLabel("Youtube: https://youtube.com/@skyhubcommunitys")

-- Fungsi untuk verifikasi key
local function verifyKey(key)
	local success, response = pcall(function()
		return game:HttpGet(verificationURL .. key)
	end)

	if success and response then
		local result = HttpService:JSONDecode(response)
		if result.success then
			return true
		end
	end
	return false
end

-- Fungsi untuk load script utama
local function loadMainScript()
	OrionLib:MakeNotification({
		Name = "SkyHub Loader",
		Content = "Memuat script utama...",
		Time = 4
	})
	pcall(function()
		loadstring(game:HttpGet(loaderURL))()
	end)
end

-- Coba baca key dari file (auto-login)
local savedKey
if pcall(function() return readfile("skyhub_key.txt") end) then
	savedKey = readfile("skyhub_key.txt")
	if verifyKey(savedKey) then
		loadMainScript()
		return -- stop Orion UI karena loader sudah jalan
	end
end

-- Jika tidak ada key / expired, munculkan input textbox
MainTab:AddTextbox({
    Name = "Masukkan Key SkyHub",
    Default = "",
    TextDisappear = false,
    Callback = function(keyInput)
        if verifyKey(keyInput) then
            OrionLib:MakeNotification({
                Name = "✅ Key Valid",
                Content = "Akses diberikan. Menyimpan dan memuat...",
                Time = 4
            })

            -- Simpan key ke file
            pcall(function()
                writefile("skyhub_key.txt", keyInput)
            end)

            -- Load loader
            loadMainScript()
        else
            OrionLib:MakeNotification({
                Name = "❌ Key Invalid",
                Content = "Key salah atau sudah expired.",
                Time = 5
            })
        end
    end
})

-- Notifikasi support
task.spawn(function()
	while true do
		OrionLib:MakeNotification({
			Name = "Support Us!",
			Content = "Join Discord & Subscribe YouTube:\nCheck the Credit tab!",
			Image = "rbxassetid://4483345998",
			Time = 5
		})
		task.wait(60)
	end
end)
